<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ServerMonitor.ViewModels"
             xmlns:microcharts="clr-namespace:Microcharts.Maui;assembly=Microcharts.Maui"
             x:Class="ServerMonitor.GraphicsPage"
             x:DataType="vm:GraphicsViewModel"
             BackgroundColor="#F5F5F5"
             Padding="12"
             Appearing="OnPageAppearing">

    <Grid RowDefinitions="Auto,Auto,*">

        <Label Grid.Row="0"
               Text="Gráficos del Servidor"
               FontSize="28"
               FontAttributes="Bold"
               FontFamily="verdana"
               HorizontalOptions="Center"
               TextColor="#1A1A1A"
               Margin="0,25,0,15"/>

        <Border Grid.Row="1"
                Stroke="#E0E0E0"
                StrokeThickness="1"
                StrokeShape="RoundRectangle 12"
                BackgroundColor="White"
                Padding="20"
                Margin="0,0,0,20">
            <VerticalStackLayout Spacing="25">
                <Label Text="Filtrar por Fecha y Sensor" 
                       FontAttributes="Bold" 
                       FontFamily="times" 
                       HorizontalOptions="Center" 
                       TextColor="#333333"
                       FontSize="16"/>

                <Grid ColumnDefinitions="*,*,*,*" 
                      ColumnSpacing="15"
                      RowSpacing="10">

                    <VerticalStackLayout Grid.Column="0" 
                                       Spacing="8">
                        <Label Text="Fecha" 
                               FontFamily="times" 
                               FontAttributes="Bold" 
                               TextColor="#555555"
                               FontSize="14"/>
                        <DatePicker Date="{Binding SelectedDate}" 
                                    TextColor="#212121"
                                    HeightRequest="40"/>
                    </VerticalStackLayout>

                    <!-- Columna 1: Sensor -->
                    <VerticalStackLayout Grid.Column="1" 
                                       Spacing="8">
                        <Label Text="Sensor:" 
                               FontFamily="times" 
                               FontAttributes="Bold" 
                               TextColor="#555555"
                               FontSize="14"/>
                        <Picker ItemsSource="{Binding Sensors}"
                                SelectedItem="{Binding SelectedSensor}"
                                HeightRequest="40"
                                HorizontalOptions="Fill"/>
                    </VerticalStackLayout>

                    <VerticalStackLayout Grid.Column="2" 
                                       Spacing="8">
                        <Label Text="Gráfico:" 
                               FontFamily="times" 
                               FontAttributes="Bold" 
                               TextColor="#555555"
                               FontSize="14"/>
                        <Picker ItemsSource="{Binding ChartTypes}"
                                SelectedItem="{Binding SelectedChartType}"
                                HeightRequest="40"
                                HorizontalOptions="Fill"/>
                    </VerticalStackLayout>

                    <VerticalStackLayout Grid.Column="3" 
                                       Spacing="8"
                                       VerticalOptions="End">
                        <Label Text=" " 
                               FontSize="14"
                               IsVisible="True"/>
                        <Button Text="Filtrar"
                                Command="{Binding FilterByDateCommand}"
                                BackgroundColor="#4d62da"
                                TextColor="White"
                                CornerRadius="8"
                                FontFamily="verdana"
                                HeightRequest="40"
                                FontAttributes="Bold"
                                HorizontalOptions="Fill"/>
                    </VerticalStackLayout>
                </Grid>
            </VerticalStackLayout>
        </Border>

        <Grid Grid.Row="2" Margin="0,50,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <ScrollView Grid.Column="0" 
                        Orientation="Horizontal"
                        HorizontalScrollBarVisibility="{Binding ScrollBarVisibility}">
                <Border Stroke="#D0D0D0"
                        StrokeThickness="2"
                        StrokeShape="RoundRectangle 18"
                        BackgroundColor="#FFFFFF"
                        Padding="15"
                        Margin="0,0,10,10"
                        MinimumWidthRequest="{Binding ChartMinWidth}"
                        WidthRequest="{Binding ChartWidth}">
                    <microcharts:ChartView Chart="{Binding Chart}"
                                           HeightRequest="300"
                                           HorizontalOptions="{Binding ChartHorizontalOptions}"
                                           VerticalOptions="Fill" />
                </Border>
            </ScrollView>
        </Grid>
    </Grid>
</ContentPage>